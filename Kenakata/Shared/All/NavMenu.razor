@implements IDisposable

<nav class="navbar navbar-expand-lg navbar-light color-green" id="big-navbar">
    <div class="container-fluid">
        <div class="container">

            <div class="d-flex justify-content-between">
                <div>
                    <ul class="navbar-nav me-auto flex-row">
                        <li class="nav-item  ">
                            <select class="selector">
                                <option class="navbarcolors">ENG</option>
                                <option class="navbarcolors">SWE</option>
                            </select>
                        </li>
                        <li class="nav-item">
                            <select class="selector">
                                <option class="navbarcolors">USD</option>
                                <option class="navbarcolors">SEK</option>
                            </select>
                        </li>

                    </ul>
                </div>
                <div class="d-flex align-items-center">
                    <ul class="navbar-nav links  flex-row">
                        <li class="nav-item me-3">
                            <a href="#">Newsletter</a>
                        </li>
                        <li class="nav-item me-3">
                            <a href="contact">Contact us</a>
                        </li>
                        <li class="nav-item">
                            <a href="#">FAQs</a>
                        </li>


                    </ul>
                    <ul class="socialmedia">
                        <li>
                            <a href="#"><i class="fab fa-facebook-f"></i></a>
                        </li>
                        <li>
                            <a href="#"><i class="fab fa-twitter"></i></a>
                        </li>
                        <li>
                            <a href="#"><i class="fab fa-google-plus-g"></i></a>
                        </li>
                        <li>
                            <a href="#"><i class="fab fa-instagram"></i></a>
                        </li>
                        <li>
                            <a href="#"><i class="fab fa-reddit-square"></i></a>
                        </li>
                    </ul>

                </div>
               
            </div>
        </div>

    </div>
</nav>
<section id="searchbar">
    <div class="container-fluid border-bottom">
        <div class="container">
            <a href="#"><img src="/Assets/Images/Fredrik/NavbarImages/Logo.svg" class="mt-2" alt=""></a>



            <ul class="listup">
                <li>
                    <div class="searchbar-group input-group">
                        <input type="text" class="form-control section-input " placeholder="Search products..." />
                        <select id="inputGroupSelect04" aria-label="Example select with button addon" class="section-select">
                            <option selected>Categories</option>
                            <option value="1">One</option>
                            <option value="2">Two</option>
                            <option value="3">Three</option>
                        </select>
                        <button class="btn section-button navbarcolors" type="button"><i class="fas fa-search"></i></button>
                    </div>
                </li>
                <li>
                    <a class="checker" href="myaccount">
                        <i class="far fa-user">  </i>
                        My account
                    </a>

                </li>
                <li class="heart-display">
                    <a href="wishlist" class="checker "> <i class="far fa-heart"></i></a>

                </li>
                <li>
                    <a class="checker" href="compare">
                        <i class="fas fa-random position-relative">
                            <span class="product-counter">@Notifier.CompareCounter</span>
                        </i>
                    </a>

                </li>
                <li>
                    <a class="checker" href="shopping-cart">
                        <i class="fas fa-shopping-bag position-relative">

                            <span class="product-counter">@Notifier.Counter</span>
                        </i>
                    </a>

                    <span id="subtotal">$@Notifier.Subtotal</span>
                </li>
            </ul>
        </div>
    </div>
</section>

<nav id="lowernavbar">
    <div class="container navlinkscontainer">
        <div class="d-flex justify-content-spacebetween ">
            <ul class="lower-navbar me-auto">
                <li class="nav-item" id="browse-dropdown">
                    <div class="dropdown">
                        <button class="btn color-green dropdown-toggle dropdown-btn " type="button" id="browse-drop" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="fas fa-bars"></i>
                            <span class="dropdown-label">Browse Categories</span>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="browse-drop">
                            <li><a class="dropdown-item" href="shop/category/men's">Men´s</a></li>
                            <li><a class="dropdown-item" href="shop/category/women's">Women´s</a></li>
                            <li><a class="dropdown-item" href="shop/category/kids">Kid´s</a></li>
                            <li><a class="dropdown-item" href="shop/category/hats">Hats</a></li>
                            <li><a class="dropdown-item" href="shop/category/sunglasses">Sunglasses</a></li>
                            <li><a class="dropdown-item" href="shop/category/shoes">Shoes</a></li>
                            <li><a class="dropdown-item" href="shop/category/watches">Watches</a></li>
                        </ul>
                    </div>
                </li>




                <NavLink Match="NavLinkMatch.All" href="/" class="nav-link "><a class="home-link">Home</a></NavLink>



                <NavLink Match="NavLinkMatch.All" href="/shop" class="nav-link">
                    <li class="nav-item ">
                        <div class="dropdown">
                            <button class="small-drop-btn  dropdown-toggle" match="all" type="button" id="dropdownMenuButton2" data-bs-toggle="dropdown" aria-expanded="false">
                                Shop<i class="fas fa-chevron-down"></i>
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton2">
                                <li><a class="dropdown-item" href="shop">Go to ShopSection</a></li>
                            </ul>
                        </div>
                    </li>
                </NavLink>



                <NavLink Match="NavLinkMatch.Prefix" href="/product-display/" class="nav-link">
                    <li class="nav-item">
                        <div class="dropdown ">
                            <button class="small-drop-btn  dropdown-toggle" type="button" id="dropdownMenuButton3" data-bs-toggle="dropdown" aria-expanded="false">
                                Products<i class="fas fa-chevron-down"></i>
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton3">
                                <li><a class="dropdown-item" href="/product-display/22">Shirt</a></li>
                                <li><a class="dropdown-item" href="/product-display/37">Shoes</a></li>
                                <li><a class="dropdown-item" href="/product-display/44">Pants</a></li>
                            </ul>
                        </div>
                    </li>
                </NavLink>
                <NavLink Match="NavLinkMatch.Prefix" href="/shop/category/" class="nav-link">
                    <li class="nav-item">
                        <div class="dropdown ">
                            <button class="small-drop-btn  dropdown-toggle" type="button" id="dropdownMenuButton4" data-bs-toggle="dropdown" aria-expanded="false">
                                Categorys<i class="fas fa-chevron-down"></i>
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton4">
                                <li><a class="dropdown-item" href="shop/category/men's">Men´s</a></li>
                                <li><a class="dropdown-item" href="shop/category/women's">Women´s</a></li>
                                <li><a class="dropdown-item" href="shop/category/kids">Kid´s</a></li>
                                <li><a class="dropdown-item" href="shop/category/hats">Hats</a></li>
                                <li><a class="dropdown-item" href="shop/category/sunglasses">Sunglasses</a></li>
                                <li><a class="dropdown-item" href="shop/category/shoes">Shoes</a></li>
                            </ul>
                        </div>
                    </li>
                </NavLink>

                <NavLink Match="NavLinkMatch.All" href="/pages" class="nav-link">
                    <li class="nav-item">
                        <div class="dropdown ">
                            <button class="small-drop-btn  dropdown-toggle" type="button" id="dropdownMenuButton5" data-bs-toggle="dropdown" aria-expanded="false">
                                Pages<i class="fas fa-chevron-down"></i>
                            </button>
                            <ul class="dropdown-menu" aria-labelledby="dropdownMenuButton5">
                                <li><a class="dropdown-item" href="aboutus">About Us</a></li>
                            </ul>
                        </div>
                    </li>
                </NavLink>
                <NavLink Match="NavLinkMatch.All" href="/blog" class="nav-link"><a>Blog</a></NavLink>
                <NavLink Match="NavLinkMatch.All" href="/wishlist" class="nav-link "><a class="wish-display">Wishlist</a></NavLink>

            </ul>
            <button class="special-offer  color-green" id="spec-offer" @onclick="SpecialOffer">SPECIAL OFFER</button>

        </div>
    </div>
</nav>


<div id="mobile-navbar">
    <div class="container">
        <nav class="navbar navbar-expand-lg navbar-light color-gray navbar-fixed-top ">

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarText1" aria-controls="navbarText1" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a href="#"><img src="/Assets/Images/Fredrik/NavbarImages/Logo.svg" class="logo" alt=""></a>
            <div class="small-icons">
                <a class="checker" href="shopping-cart">
                    <i class="fas fa-shopping-bag position-relative">

                        <span class="product-counter">@Notifier.Counter</span>
                    </i>
                </a>
            </div>


            <div class="collapse navbar-collapse" id="navbarText1">


                <div class="input-group mt-2">
                    <input type="text" name="search" placeholder="Search..">
                    <!-- <button type="submit"><i class="fa fa-search"></i></button> -->
                    <button class="btn section-button navbarcolors" type="button"><i class="fas fa-search"></i></button>
                </div>
                <ul class="navbar-nav  ">
                    <li class="nav-item mb-2 ">
                        <NavLink Match="NavLinkMatch.All" href="/" class="nav-link"><a><i class="fas fa-home"></i> Home</a></NavLink>
                    </li>
                    <li class="nav-item mb-2">
                        <NavLink Match="NavLinkMatch.All" href="shop" class="nav-link"><a><i class="fas fa-shopping-basket"></i> Shop</a></NavLink>
                    </li>
                    <li class="nav-item mb-2">
                        <NavLink Match="NavLinkMatch.All" href="products" class="nav-link"><a><i class="fas fa-tshirt"></i> Products</a></NavLink>
                    </li>
                    <li class="nav-item">
                        <NavLink Match="NavLinkMatch.All" href="myaccount" class="nav-link"><a class="checker"><i class="far fa-user"></i> My account</a></NavLink>
                    </li>
                    <li class="nav-item mb-2">
                        <NavLink Match="NavLinkMatch.All" href="compare" class="nav-link">
                            <a>
                                <i class="fas fa-random position-relative">
                                    <span style="font-family:Roboto;  font-weight:400"> Compare</span>
                                    <span class="product-counter">@Notifier.CompareCounter</span>
                                </i>
                            </a>
                        </NavLink>
                    </li>
                    <li class="nav-item mb-2">
                        <NavLink Match="NavLinkMatch.All" href="wishlist" class="nav-link"><a> <i class="far fa-heart"></i> Wishlist</a></NavLink>
                    </li>
                    <li class="nav-item mb-2">
                        <NavLink Match="NavLinkMatch.All" href="contact" class="nav-link"><a><i class="far fa-envelope"></i> Contact us</a></NavLink>
                    </li>
                    <li class="nav-item mb-2">
                        <i class="fab fa-themeisle"></i> FAQs
                    </li>
                </ul>
                <ul class="d-flex list-unstyled" id="socialmedia">
                    <li>
                        <a href="#"><i class="fab fa-facebook-f"></i></a>
                    </li>
                    <li>
                        <a href="#"><i class="fab fa-twitter"></i></a>
                    </li>
                    <li>
                        <a href="#"><i class="fab fa-google-plus-g"></i></a>
                    </li>
                    <li>
                        <a href="#"><i class="fab fa-instagram"></i></a>
                    </li>
                    <li>
                        <a href="#"><i class="fab fa-reddit-square"></i></a>
                    </li>
                </ul>

            </div>
        </nav>
    </div>
</div>

@code{


    private ShoppingCart mycart;
    private CompareModel comparelist;
    List<Product> prds;
    private int productcount = 0;
    private decimal subtotal = 0;
    private decimal prodquantprice = 0;
    private int prodquant = 0;




    protected override async Task OnInitializedAsync()
    {
        Notifier.Notify += OnNotify;

        mycart = await session.GetItemAsync<ShoppingCart>("MyShoppingCart");
        comparelist = await session.GetItemAsync<CompareModel>("MyCompareList");
        if (mycart != null)
        {
            @foreach (var item in mycart.Items)
            {
                productcount = productcount + item.Quantity;

                prodquantprice = item.Product.Price * item.Quantity;
                subtotal = subtotal + prodquantprice;



            }
            @if (mycart.CouponDiscount == 0)
            {
                subtotal = subtotal * 1;
            }
            else
            {
                subtotal = subtotal * mycart.CouponDiscount;
            }
        }
        if (comparelist != null)
        {
            Notifier.CompareCounter = comparelist.Products.Count();

        }
        else
        {
            Notifier.CompareCounter = 0;
        }
        Notifier.Subtotal = subtotal;

        Notifier.Counter = productcount;

    }


    public async Task OnNotify()
    {
        await InvokeAsync(() =>
        {
            StateHasChanged();
        });
    }

    public void Dispose()
    {
        Notifier.Notify -= OnNotify;
    }


    private async Task SpecialOffer()
    {
        prds = await Http.GetFromJsonAsync<List<Product>>("https://kenakataapi.azurewebsites.net/api/products/");
        var random = new Random();
        var id = random.Next(30, 40);

        NavManager.NavigateTo($"/Product-Display/{id}");

    }
}