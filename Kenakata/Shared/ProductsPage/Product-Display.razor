@page "/Product-Display/{id}"

@implements IDisposable
<!--top DIV PRODUCT-PAGE-->
<section id="products-topdiv">
    <div class="container">
        <div>
            <button>Home</button>
            /
            <button>Shop</button>
            /
            <button>@product.ProductName</button>
        </div>
        <div class="brandlink">
            <button>
                <img src="/Assets/Images/Mattias/Brands/Bexim.svg" alt="">
            </button>
            <label class="pointer" for="select-4style-list">
                <img src="/Assets/Images/Fredrik/ListSortingImages/Group 483.svg" alt="">
            </label>
        </div>
    </div>
</section>

<!--top DIV PRODUCT-PAGE END-->
<StickyButton />
<div id="product-display">
    <div class="container">
        <div>


            <ul class="d-flex list-unstyled mb-0">
                <li>
                    <div class="xl-picture">
                        <img class="bg-gray" src="@product.Picture" alt="">
                        <div class="popupicon"><img src="/Assets/Images/Fredrik/Product-DisplayImages/Group 759.svg" alt=""></div>
                    </div>

                </li>
                <li class="ms-3">
                    <div>
                        <img class="diffrent-angles" src="/Assets/Images/Fredrik/Product-DisplayImages/shoes-placeholder.svg" alt="">
                    </div>
                    <div>
                        <img class="diffrent-angles" src="/Assets/Images/Fredrik/Product-DisplayImages/shoes-placeholder.svg" alt="">
                    </div>
                    <div>
                        <img class="diffrent-angles" src="/Assets/Images/Fredrik/Product-DisplayImages/shoes-placeholder.svg" alt="">
                    </div>
                    <div>
                        <img class="diffrent-angles" src="/Assets/Images/Fredrik/Product-DisplayImages/shoes-placeholder.svg" alt="">
                    </div>
                </li>
                <li class="ms-4">
                    <div>
                        <p class="product-headers">@product.ProductName</p>
                        <p class="short-descrip ">@product.ShortDescription</p>
                    </div>
                    <div class="d-flex ">
                        <div class="me-3  extra-price">$@product.Price</div>

                        <div class="me-4 mt-1 old-price">$@product.OldPrize</div>
                        <img class="mb-1" src="/Assets/Images/Fredrik/Product-DisplayImages/In stock.svg" alt="">
                        <div class="mt-1 ms-2">In Stock</div>
                    </div>
                    <div>
                        <div class="quantity d-flex">
                            <div class="input-group ">
                                <button class="minus-btn" type="button" name="button" @onclick="@DecrementCount">
                                    <i class="fas fa-minus"></i>
                                </button>

                                <input type="text" name="name" value="@currentCount" />
                                <button class="plus-btn me-3" type="button" name="button" @onclick="@IncrementCount">
                                    <i class="fas fa-plus"></i>
                                </button>


                            </div>
                            <div class="d-flex">
                                <button class=" ms-3  shop-btn color-green" @onclick="@AddProduct"><img class="me-1" src="/Assets/Images/Fredrik/Product-DisplayImages/Cart icon.svg" alt=""> Add to cart</button>
                                <div class="colors-div"><img src="/Assets/Images/Fredrik/Product-DisplayImages/Group 667.svg" alt=""></div>
                                <div class="random-heart-div" @onclick="@AddToCompareList">
                                    <i class="fas fa-random"></i>
                                    <div class="add-to-compare">Add to comparelist</div>
                                </div>

                                <div class="random-heart-div">
                                    <i @onclick="() => addtoWishlist(product.Id)" id="wishlistheart" class="far fa-heart"></i>

                                    <div class="add-to-wishlist">Add to wishlist</div>
                                </div>

                            </div>
                        </div>
                    </div>

                    <div class="mt-3 mb-4">Catagory:<a class="catagory-link ms-1" href="">@category</a></div>

                    <div class="mb-4">Tags:<span class="tag-design ms-4">@brand</span><span class="tag-design">@colour</span><span class="tag-design">@size</span></div>
                    <div>
                        <span class="me-3">Share:</span>
                        <span>
                            <a class="share-design-ep" href="#"><i class="fab fa-facebook-f "></i></a>
                        </span>
                        <span>
                            <a class="share-design" href="#"><i class="fab fa-twitter"></i></a>
                        </span>
                        <span>
                            <a class="share-design gp-color" href="#"><i class="fab fa-google-plus-g"></i></a>
                        </span>
                        <span>
                            <a class="share-design insta-color" href="#"><i class="fab fa-instagram"></i></a>
                        </span>
                        <span>
                            <a class="share-design-ep" href="#"><i class="fab fa-reddit-square"></i></a>
                        </span>
                    </div>
                </li>
            </ul>
        </div>
    </div>
    
</div>


<div id="tablet-product-display">
    <div class="container">



        <ul class="d-flex list-unstyled mb-0">
            <li>
                <div class="xl-picture">
                    <img class="image-tablet" src="@product.Picture" alt="">
                    <div class="popupicon"><img src="/Assets/Images/Fredrik/Product-DisplayImages/Group 759.svg" alt=""></div>
                </div>

            </li>
            <li class="ms-4">
                <div>
                    <p class="product-headers">@product.ProductName</p>
                    <p class="short-descrip ">@product.ShortDescription</p>
                </div>
                <div class="d-flex ">
                    <div class="me-3  extra-price">$@product.Price</div>

                    <div class="me-4 mt-1 old-price">$@product.OldPrize</div>
                    <img class="mb-1" src="/Assets/Images/Fredrik/Product-DisplayImages/In stock.svg" alt="">
                    <div class="mt-1 ms-2">In Stock</div>
                </div>
                <div>
                    <div class="quantity d-flex">
                        <div class="input-group ">
                            <button class="minus-btn" type="button" name="button" @onclick="@DecrementCount">
                                <i class="fas fa-minus"></i>
                            </button>

                            <input type="text" name="name" value="@currentCount" />
                            <button class="plus-btn me-3" type="button" name="button" @onclick="@IncrementCount">
                                <i class="fas fa-plus"></i>
                            </button>


                        </div>
                        <div class="d-flex">
                            <button class="shop-btn color-green" @onclick="@AddProduct"><img class="me-1" src="/Assets/Images/Fredrik/Product-DisplayImages/Cart icon.svg" alt=""> Add to cart</button>


                        </div>
                    </div>
                </div>
                <div class="d-flex mt-3">
                    <div class="colors-div"><img src="/Assets/Images/Fredrik/Product-DisplayImages/Group 667.svg" alt=""></div>
                    <div class="random-heart-div" @onclick="@AddToCompareList">
                        <i class="fas fa-random"></i>
                        <div class="add-to-compare">Add to comparelist</div>
                    </div>

                    <div class="random-heart-div">
                        <i @onclick="() => addtoWishlist(product.Id)" id="wishlistheart" class="far fa-heart"></i>

                        <div class="add-to-wishlist">Add to wishlist</div>
                    </div>
                </div>
                <div class="mt-3 mb-4">Catagory:<a class="catagory-link ms-1" href="">@category</a></div>

                <div class="mb-4">Tags:<span class="tag-design ms-4">@brand</span><span class="tag-design">@colour</span><span class="tag-design">@size</span></div>
                <div>
                    <span class="me-3">Share:</span>
                    <span>
                        <a class="share-design-ep" href="#"><i class="fab fa-facebook-f "></i></a>
                    </span>
                    <span>
                        <a class="share-design" href="#"><i class="fab fa-twitter"></i></a>
                    </span>
                    <span>
                        <a class="share-design gp-color" href="#"><i class="fab fa-google-plus-g"></i></a>
                    </span>
                    <span>
                        <a class="share-design insta-color" href="#"><i class="fab fa-instagram"></i></a>
                    </span>
                    <span>
                        <a class="share-design-ep" href="#"><i class="fab fa-reddit-square"></i></a>
                    </span>
                </div>
            </li>
        </ul>

    </div>
</div>

<div id="mobile-product-display">
    <div class="container">
        <div>


            <ul class=" list-unstyled mb-0">
                <li>
                    <div class="">
                        <img class="image-phone" src="@product.Picture" alt="">

                    </div>

                </li>
                <li>
                    <div>
                        <p class="product-headers">@product.ProductName</p>
                        <p class="short-descrip ">@product.ShortDescription</p>
                    </div>
                    <div class="d-flex ">
                        <div class="me-3  extra-price">$@product.Price</div>

                        <div class="me-4 mt-1 old-price">@product.OldPrize</div>
                        <img class="mb-1" src="/Assets/Images/Fredrik/Product-DisplayImages/In stock.svg" alt="H">
                        <div class="mt-1 ms-2">In Stock</div>
                    </div>
                    <div>
                        <div class="quantity d-flex">
                            <div class="input-group ">
                                <button class="minus-btn" type="button" name="button" @onclick="@DecrementCount">
                                    <i class="fas fa-minus"></i>
                                </button>

                                <input type="text" name="name" value="@currentCount" />
                                <button class="plus-btn me-3" type="button" name="button" @onclick="@IncrementCount">
                                    <i class="fas fa-plus"></i>
                                </button>


                            </div>
                            <div class="colors-div"><img src="/Assets/Images/Fredrik/Product-DisplayImages/Group 667.svg" alt=""></div>
                            <div class="random-heart-div" @onclick="@AddToCompareList">
                                <i class="fas fa-random"></i>
                                <div class="add-to-compare">Add to comparelist</div>
                            </div>

                            <div class="random-heart-div">
                                <i @onclick="() => addtoWishlist(product.Id)" id="wishlistheart" class="far fa-heart"></i>

                                <div class="add-to-wishlist">Add to wishlist</div>
                            </div>
                        </div>
                    </div>

                    <button class="mobile-shop-btn color-green" @onclick="@AddProduct"><img class="me-1" src="/Assets/Images/Fredrik/Product-DisplayImages/Cart icon.svg" alt=""> Add to cart</button>

                    <div class="mt-4">
                        <span class="me-3">Share:</span>
                        <span>
                            <a class="share-design-ep" href="#"><i class="fab fa-facebook-f "></i></a>
                        </span>
                        <span>
                            <a class="share-design" href="#"><i class="fab fa-twitter"></i></a>
                        </span>
                        <span>
                            <a class="share-design gp-color" href="#"><i class="fab fa-google-plus-g"></i></a>
                        </span>
                        <span>
                            <a class="share-design insta-color" href="#"><i class="fab fa-instagram"></i></a>
                        </span>
                        <span>
                            <a class="share-design-ep" href="#"><i class="fab fa-reddit-square"></i></a>
                        </span>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div>

<Tab_Section />
<InfoSection />
<Kenakata.Shared.Textbanner.Alsolikecart />
<Kenakata.Shared.ShoppingCartPage.CartCarousel/>
<Subscribe />
<Brands />


@code{
    [Parameter]
    public string Id { get; set; }

    private Product product { get; set; }

    private string category;
    private string brand;
    private string colour;
    private string size;
    private int currentCount = 1;
    private int prodquant = 0;
    private decimal subtotal = 0;
    private decimal pricquan = 0;




    protected override async Task OnInitializedAsync()
    {

        try
        {
            Notifier.Notify += OnNotify;
            product = new Product();
            var id = int.Parse(Id);
            product = await Http.GetFromJsonAsync<Product>($"https://kenakataapi.azurewebsites.net/api/products/{id}");
            product.Price = Math.Truncate(product.Price);
            product.OldPrize = Math.Truncate(product.OldPrize);
            category = product.Category.CategoryName;
            brand = product.Brand.BrandName;
            colour = product.Colour.ColourName;
            size = product.Size.SizeName;

        }
        catch { }


    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("shopcartcarousel");
        }
    }

    public async Task OnNotify()
    {
        await InvokeAsync(() =>
        {
            StateHasChanged();
        });
    }

    private void IncrementCount()
    {
        currentCount++;
    }

    private void DecrementCount()
    {
        @if (currentCount > 1)
        {
            currentCount--;


        }
        else
        {

        }
    }
    public void Dispose()
    {
        Notifier.Notify -= OnNotify;
    }


    private async Task addtoWishlist(int id)
    {

        var wishlist = await session.GetItemAsync<WishlistitemModel>("WishlistItems");

        if (wishlist.Items.Any(i => i.Id == id))
        {
            singlewishlistItem item = wishlist.Items.FirstOrDefault(i => i.Id == id);
            wishlist.Items.Remove(item);
            await session.SetItemAsync("WishlistItems", wishlist);
        }

        else
        {
            wishlist.Items.Add(new singlewishlistItem { Id = id });
            await session.SetItemAsync("WishlistItems", wishlist);
            await JSRuntime.InvokeVoidAsync(identifier: "wishlistheart1");
        }

    }
}
@functions{
    private async Task AddProduct()
    {


        var cart = await session.GetItemAsync<ShoppingCart>("MyShoppingCart");

        prodquant = 0;
        subtotal = 0;
        foreach (var item in cart.Items)
        {
            prodquant = prodquant + item.Quantity;
            pricquan = item.Product.Price * item.Quantity;
            subtotal = subtotal + pricquan;
        }
        var list = cart.Items.Where(x => x.Product.Id == product.Id);
        @if (list.Any())
        {
            var specproduct = list.FirstOrDefault();
            specproduct.Quantity = specproduct.Quantity + currentCount;
            await session.SetItemAsync("MyShoppingCart", cart);
            pricquan = specproduct.Product.Price * currentCount;
        }
        else
        {
            cart.Items.Add(new CartProduct { Product = product, Quantity = currentCount });
            await session.SetItemAsync("MyShoppingCart", cart);
            pricquan = product.Price * currentCount;

        }

        prodquant = prodquant + currentCount;

        subtotal = subtotal + pricquan;
        subtotal = subtotal * cart.CouponDiscount;
        Notifier.Subtotal = subtotal;
        Notifier.Counter = prodquant;

    }


    private async Task AddToCompareList()
    {
        var comparelist = await session.GetItemAsync<CompareModel>("MyCompareList");
        @if (comparelist.Products.Count() < 3)
        {
            var list = comparelist.Products.Where(x => x.Id == product.Id);
            @if (list.Any())
            {
                var specproduct = list.FirstOrDefault();
                comparelist.Products.Remove(specproduct);
                await session.SetItemAsync("MyCompareList", comparelist);
            }
            else
            {
                comparelist.Products.Add(product);
                await session.SetItemAsync("MyCompareList", comparelist);

            }
            comparelist = await session.GetItemAsync<CompareModel>("MyCompareList");

            Notifier.CompareCounter = comparelist.Products.Count();
        }

    }
}
